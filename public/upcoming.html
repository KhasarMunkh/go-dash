<!doctype html>
<html><head><meta charset="utf-8"><title>Upcoming</title></head>
<body>
  <p><a href="/settings.html">Edit selection</a></p>
  <h1>Upcoming Matches</h1>
  <div id="matches">Loadingâ€¦</div>
  <script>
    function getSelectedIds() {
      try { return JSON.parse(localStorage.getItem("selectedTeamIds")) || []; }
      catch { return []; }
    }
    async function load() {
      const ids = getSelectedIds();
      const game = "lol"; // or read from a saved setting
      const qs = new URLSearchParams({ game, per_page: "50" });
      if (ids.length) qs.set("team_id", ids.join(","));
      const res = await fetch(`/api/upcoming-matches?${qs.toString()}`);
      const data = await res.json();
      const out = document.getElementById("matches");
      if (!Array.isArray(data) || !data.length) { out.textContent = "No upcoming matches."; return; }
      out.innerHTML = data.map(m => `
        <div style="border:1px solid #ccc;margin:.5rem 0;padding:.5rem;">
          <b>${m.name || (m.opponents?.map(o=>o.opponent?.name).filter(Boolean).join(" vs ")) || "Match"}</b>
          <div>${m.league?.name ?? ""}</div>
          <div>${m.begin_at ? new Date(m.begin_at).toLocaleString() : ""}</div>
        </div>
      `).join("");
    }
    window.addEventListener("DOMContentLoaded", load);
  </script>
</body></html>

